# سیستم رزرواسیون بهینه

این پروژه یک سیستم رزرواسیون RESTful با کارایی بالا است که به عنوان بخشی از فرآیند مصاحبه فنی طراحی و پیاده‌سازی شده است. هدف اصلی، نمایش مهارت‌های پیشرفته در طراحی سیستم، مدیریت تراکنش‌ها، بهینه‌سازی عملکرد و مدیریت همزمانی در یک محیط پرترافیک است.

[![Java](https://img.shields.io/badge/Java-21-blue.svg)](https://www.java.com)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.x-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![MySQL](https://img.shields.io/badge/MySQL-8.0-blue.svg)](https://www.mysql.com)
[![Redis](https://img.shields.io/badge/Redis-6.x-red.svg)](https://redis.io)
[![Docker](https://img.shields.io/badge/Docker-Enabled-blue.svg)](https://www.docker.com)

## 🌟 ویژگی‌های اصلی

* **احراز هویت کاربران:** ثبت‌نام و ورود امن کاربران با استفاده از **JWT**.
* **مشاهده زمان‌های خالی:** نمایش لیست زمان‌های آزاد به صورت صفحه‌بندی شده (Paginated) با سرعت پاسخ‌گویی بسیار بالا.
* **رزرو زمان:** قابلیت رزرو یک اسلات زمانی به صورت **Atomic** برای مدیریت درخواست‌های همزمان و جلوگیری از رزرو تکراری (Race Condition).
* **لغو رزرو:** امکان لغو یک رزرو توسط کاربر، که باعث آزاد شدن مجدد آن اسلات می‌شود.
* **مستندات API:** مستندسازی کامل تمام Endpoint ها با استفاده از **Swagger (OpenAPI)**.

## 🛠️ تکنولوژی‌های استفاده شده

* **زبان و فریمورک:** Java 21, Spring Boot 3
* **پایگاه داده:** MySQL
* **کش در حافظه:** Redis
* **امنیت:** Spring Security, JWT
* **مدیریت دیتابیس:** Flyway (برای Version-Controlled Schema Migration)
* **ابزارهای کمکی:** Lombok, Maven, Docker
* **مستندسازی:** SpringDoc (Swagger UI)

##  معماری و تصمیمات کلیدی طراحی

این پروژه با تمرکز بر مقیاس‌پذیری و عملکرد طراحی شده است.

### ۱. مدیریت همزمانی (Concurrency) با Redis & Lua

بزرگترین چالش پروژه، جلوگیری از رزرو یک اسلات توسط چند کاربر به صورت همزمان است. برای حل این مشکل از یک **اسکریپت Lua** در سمت Redis استفاده شده است. اسکریپت‌های Lua به صورت **Atomic** در Redis اجرا می‌شوند. این اسکریپت ابتدا چک می‌کند که آیا ID اسلات در مجموعه (ZSET) اسلات‌های آزاد وجود دارد یا خیر و در صورت وجود، آن را حذف می‌کند. این عملیات ترکیبی (Check-then-act) چون در یک فرمان اجرا می‌شود، از هرگونه Race Condition جلوگیری می‌کند.

### ۲. بهینه‌سازی عملکرد با Caching

برای رسیدن به زمان پاسخگویی بسیار سریع برای API لیست زمان‌های آزاد (`GET /api/v1/slots`):
* تمام ID های اسلات‌های آزاد در یک **Redis Sorted Set (ZSET)** ذخیره می‌شوند. score هر عضو، زمان شروع اسلات (timestamp) است که امکان مرتب‌سازی و صفحه‌بندی سریع را فراهم می‌کند.
* **Cache Warming:** در زمان استارت آپ (`@PostConstruct`)، کش با اسلات‌های موجود پر می‌شود تا اولین درخواست با تاخیر مواجه نشود.
* **Cache Cleanup:** یک وظیفه زمان‌بندی شده (`@Scheduled`) هر شب اجرا می‌شود تا اسلات‌های منقضی شده را از کش پاک کند.
* **Cache Invalidation:** هنگام رزرو یا لغو، کش به صورت لحظه‌ای و اتمیک آپدیت می‌شود (ID حذف یا اضافه می‌شود).

### ۳. مدیریت پایگاه داده با Flyway

تمام تغییرات اسکیمای دیتابیس (ایجاد جداول، افزودن ستون‌ها و...) از طریق اسکریپت‌های SQL در **Flyway** مدیریت می‌شود. این کار تضمین می‌کند که وضعیت دیتابیس در تمام محیط‌ها یکسان و قابل ردیابی باشد.

---

## 🚀 راه‌اندازی و اجرا

پروژه به طور کامل **Dockerized** شده است و برای اجرا تنها به Docker نیاز دارد.

### پیش‌نیازها

* Docker & Docker Compose

### مراحل اجرا

۱. **کلون کردن پروژه:**
```bash
git clone <your-repository-url>
cd <project-directory>
```

۲. **ساخت ایمیج و اجرای تمام سرویس‌ها:**
تمام سرویس‌های مورد نیاز (اپلیکیشن، دیتابیس MySQL و کش Redis) با یک دستور از طریق Docker Compose راه‌اندازی می‌شوند.
```bash
docker-compose up --build -d
```
* `--build`: ایمیج داکر اپلیکیشن را با استفاده از `Dockerfile` می‌سازد.
* `-d`: سرویس‌ها را در حالت detached (در پس‌زمینه) اجرا می‌کند.

پس از چند لحظه، کل سیستم آماده به کار است! اپلیکیشن روی پورت `8083` در دسترس خواهد بود.

## 📚 مستندات API

پس از اجرای پروژه، مستندات کامل و تعاملی API از طریق Swagger UI در دسترس است. می‌توانید تمام API ها را از همین صفحه تست کنید:

**[http://localhost:8083/swagger-ui/index.html](http://localhost:8083/swagger-ui/index.html)**

### خلاصه Endpoints

| Method   | Path                               | Description                      | Auth Required |
| :------- | :--------------------------------- | :------------------------------- | :-----------: |
| `POST`   | `/api/v1/authentication/signup`    | ثبت‌نام کاربر جدید               |      No       |
| `POST`   | `/api/v1/authentication/login`     | ورود کاربر و دریافت توکن JWT      |      No       |
| `GET`    | `/api/v1/slots`                    | دریافت لیست زمان‌های آزاد       |      No       |
| `POST`   | `/api/v1/reservation`              | رزرو یک اسلات زمانی              |      Yes      |
| `DELETE` | `/api/v1/reservation/{id}`         | لغو یک رزرو                      |      Yes      |